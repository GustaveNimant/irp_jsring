<!DOCTYPE html>
<html>
    <body>
	<div>
	    Ipfs Hash <input name="hash" type="text" value="" size="50px" placeholder="">
	    <input type="button" onClick="showPinType(getValueOfName('hash'))" value="Pin">
	    <input type="button" onClick="showPinTypeFunction(getValueOfName('hash'))" value="Appel dans une autre fonction">	    
	</div>
	<p style="color:green" id="result"></p>
        <span style="color:red" id="error"></span>
	<br><br><span style="background:blue;color:white" id="appel">Appel</span>

	<script>

	 function getValueOfName(name) {
	     console.log('getValueOfName input name',name);
	     let elements = document.getElementsByName(name)
	     console.log('getValueOfName elements',elements);
	     let result = elements[0].value;
	     console.log('getValueOfName result',result);
	     return result;
	 }
	 
	 function getPinType(hash) {
	     console.log('getPinType.input.hash',hash);
	     const api_url = 'http://127.0.0.1:5001/api/v0/'
	     var url;
	     if (hash == '') {
		 url = api_url + 'pin/ls?type=direct'
	     } else {
		 url = api_url + 'pin/ls?arg=/ipfs/'+hash+'&type=all'
	     }
	     console.log('getPinType url',url)
	     return fetchGetJson(url)
		 .then( json => { console.log('getPinType json.Keys[hash]: ',json.Keys[hash]);return json.Keys[hash]; })
		 .then( obj => { console.log('getPinType obj.Type: ',obj.Type);
		     return obj.Type;})
		 .catch(logError)
	 }
	 
	 function showPinType(hash) {
	     console.log('showPinType.input.hash',hash);
	     getPinType(hash)
		 .then (type => { console.log('showPinType type', type);
		     document.getElementById('result').innerHTML = type})
		 .catch(err => logError(err)) 
	 }
	 
	 function showPinTypeFunction(hash) {
	     console.log('showPinTypeFunction.input.hash',hash);
	     showPinType(hash)
		 .then (obj => {console.log('showPinTypeFunction.obj', obj);
		     document.getElementById('appel').innerHTML = obj;
		 })
	 }

	 function fetchGetJson(url) {
	     console.log('fetchGetJson.url: '+url)
	     return fetch(url,{ method: "GET"} )
		 .then(validate)
		 .then( resp => resp.json() )
	 }
	 
	 function validate(resp) {
	     if (resp.status >= 200 && resp.status < 300) {
		 return Promise.resolve(resp)
	     } else {
		 console.log('status:',resp.status)
		 return Promise.reject(new Error(resp.statusText))
	     }
	 }
	 function logError(err) { console.error(err); }
	 
	</script>
    </body>
</html>

